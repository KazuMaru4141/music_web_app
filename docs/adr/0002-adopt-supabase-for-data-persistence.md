# ADR 0001: Google SheetsからSupabase (PostgreSQL) への移行

## Status
Accepted

## Context
本プロジェクトは初期段階において、手軽なデータストアとしてGoogle Sheetsを使用してきた。しかし、アプリケーションが「単なる記録帳」から「データ活用による音楽ディグ（探索）アプリ」へと進化する過程で、以下の技術的課題に直面している。

1. **データ関係の複雑化**: アーティスト、アルバム、楽曲、および「関連アーティスト（多対多）」のようなリレーションシップをスプレッドシートのフラットな構造で管理することが限界に達している。
2. **データの整合性**: 重複チェックやIDの一意性（Spotify ID等）をアプリケーションロジック（`lib/google-sheets.ts`での全行スキャンと`indexOf`検索など）で担保しており、処理効率が悪くバグの温床となっている。
3. **パフォーマンス**: データ量が増加するにつれてAPIの読み書き制限やレイテンシが顕在化しており、「Smart Queue」のような複数条件（年代、レート、未聴など）を組み合わせたクエリの実装が困難である。
4. **将来の拡張性**: 今後、Gemini等のAIが生成したテキストの意味（ベクトル）を保存し、曖昧検索を行う機能の実装を計画しているが、Sheetsではこの基盤を作れない。

## Decision
永続化層（データベース）として **Supabase (PostgreSQL)** を採用し、Google Sheetsから移行する。

Spotify IDを主キー（Primary Key）としたリレーショナルデータベース設計を行い、既存のGoogle Sheets連携コードは段階的に廃止、または入力インターフェースとしての利用に留める。

## Consequences
### Positive (メリット)
* **リレーションの正規化**: RDBの機能を活用し、アーティスト間の関連性や楽曲情報の親子関係を効率的に管理・取得できる。
* **堅牢な整合性**: データベースレベルでのユニーク制約（Unique Constraint）により、アプリケーション側での複雑な重複チェックコードを削除でき、データの信頼性が向上する。
* **パフォーマンス向上**: インデックスを活用することで、数万件規模のデータに対しても高速な検索・フィルタリングが可能になる。
* **AI機能への布石**: `pgvector` 拡張を利用可能になるため、将来的にベクトル検索を用いたレコメンデーション機能を実装できる基盤が整う。

### Negative (デメリット・コスト)
* **学習コスト**: SQLおよびSupabaseクライアントライブラリ（`@supabase/supabase-js`）の知識が必要となる。
* **スキーマ管理**: スプレッドシートのような自由な列追加ができなくなるため、マイグレーション（Migration）による厳密なスキーマ変更管理が必要になる。

## References
* [Supabase Documentation](https://supabase.com/docs)
* [pgvector Documentation](https://github.com/pgvector/pgvector)